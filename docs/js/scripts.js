const clockContainer=document.querySelector("#clock_container"),tabbedContentContainer=document.querySelector("#tabbedContent"),timersContainer=document.querySelector("#timers_container"),CLOCK=document.querySelector("#clock"),DOTS_CONTAINER=document.querySelector("#dotsContainer"),LINE_CONTAINER=document.querySelector("#lineContainer"),LINE=document.querySelector("#line"),CIRCLE_CONTAINER=document.querySelector("#circleContainer"),CIRCLE=document.querySelector("#circleContainer .circle"),FILL_CIRCLE=document.querySelector("#circleContainer .fill-circle");let clockSize={width:clockContainer.clientWidth,height:clockContainer.clientHeight,circle:clockContainer.clientWidth-40,radius:(clockContainer.clientWidth-40)/2},OPTIONS={},CLOCK_INTERVAL=setInterval(showClockTime,1e3),TIMERS={count:0,docs:{}},storedTimers=localStorage.getItem("sktt_timers")?JSON.parse(localStorage.getItem("sktt_timers")):null;null!==storedTimers&&(storedTimers.count=Object.keys(storedTimers.docs).length);let TIME_ENTRIES={count:0,docs:{}},storedTimeEntries=localStorage.getItem("sktt_time_entries")?JSON.parse(localStorage.getItem("sktt_time_entries")):null;function getChildren(e,t){for(var s=[];e;e=e.nextSibling)1==e.nodeType&&e!=t&&s.push(e);return s}function getSiblings(e){return getChildren(e.parentNode.firstChild,e)}function getTimeObject(e){return{h:Math.floor(e/3600),m:Math.floor(e/60%60),s:Math.floor(e%60)}}function getTimer(e){let t=null;return t=document.querySelectorAll(".timer").forEach((t=>{if(t.dataset.idx===e)return t})),t}function showToast(e){options={type:"info",fadeDelay:5e3,position:"bl",title:"Toast Title",message:"This is a toast notification",...e};let t=uuidv4(),s=document.querySelector("#toastTemplate").content.cloneNode(!0).querySelector(".toast");s.setAttribute("id",`toast-${t}`),s.querySelector(".content").innerHTML=""!==options.title?`<h6>${options.title}</h6>`:"",s.querySelector(".content").innerHTML+=`<p>${options.message}</p>`,s.querySelector(".close").addEventListener("click",(function(){s.classList.remove("active"),setTimeout((()=>{s.remove()}),800)})),document.querySelector("body").append(s),s.classList.add(options.position,options.type),setTimeout((()=>{s.classList.add("active")}),200),options.fadeDelay>0&&setTimeout((()=>{s.classList.remove("active"),setTimeout((()=>{s.remove()}),800)}),options.fadeDelay)}if(null!==storedTimeEntries&&(storedTimeEntries.count=Object.keys(storedTimeEntries.docs).length),null===storedTimeEntries&&(localStorage.setItem("sktt_time_entries",JSON.stringify(TIME_ENTRIES)),storedTimeEntries=TIME_ENTRIES),null===storedTimers&&(localTimers("save"),storedTimers=localTimers("get")),0===storedTimers.count){buildTimer(uuidv4())}else Object.keys(storedTimers.docs).forEach((e=>{buildTimer(e)}));function localTimers(e){let t;return"get"===e&&(t=JSON.parse(localStorage.getItem("sktt_timers"))),"set"!==e&&"save"!==e||(localStorage.setItem("sktt_timers",JSON.stringify(TIMERS)),t={message:"saved timers"}),"clear"===e&&(localStorage.removeItem("sktt_timers"),t={message:"timers removed"}),t}function showTimerTime(e,t,s=!1){if(s){let s=dayjs(TIMERS.docs[t].start),i=dayjs().diff(s,"second",!0),o=getTimeObject(i);TIMERS.docs[t]={...TIMERS.docs[t],secondsElapsed:Math.floor(i)},localTimers("save"),e.innerText=`${padTime(o.h)}:${padTime(o.m)}:${padTime(o.s)}`}else if(TIMERS.docs[t].secondsElapsed>0){let s=getTimeObject(TIMERS.docs[t].secondsElapsed);e.innerText=`${padTime(s.h)}:${padTime(s.m)}:${padTime(s.s)}`}else e.innerText="00:00:00"}function padTime(e){return e<10&&(e=`0${e}`),e}function updateData(e){let t,s;storedTimers=localTimers("get"),storedTimers.docs[e]?(TIMERS.docs[e]={...storedTimers.docs[e],interval:null},storedTimeEntries.docs[e]&&(TIME_ENTRIES.docs[e]={...storedTimeEntries.docs[e]})):(TIMERS.docs[e]={title:`timer-${e.substring(0,5)}`,interval:null,start:dayjs(),secondsElapsed:0},TIME_ENTRIES.docs[e]={title:`timer-${e.substring(0,5)}`,created:dayjs(),updated:dayjs(),secondsElapsed:0}),TIME_ENTRIES.count=Object.keys(TIME_ENTRIES.docs).length,localTimers("save"),document.querySelectorAll(".timer").forEach((i=>{i.dataset.idx===e&&(t=i,s=i.querySelector(".time"))})),void 0!==t&&showTimerTime(s,e)}function updateTitle(e,t){TIMERS.docs[e].title=t,localTimers("save"),TIME_ENTRIES.docs[e]&&(TIME_ENTRIES.docs[e].title=t,localTimeEntries("save"))}function buildTimer(e){if(void 0!==e){let t=document.querySelector("#timerTemplate").content.cloneNode(!0);t.querySelector(".timer").dataset.idx=e;let s=t.querySelector(".time-container"),i=t.querySelector(".time-container").innerHTML;s.innerHTML=i.replace("${uuid}",e);let o=`timer-${e.substring(0,5)}`,c=t.querySelector(".form"),a=t.querySelector(".form").innerHTML;c.innerHTML=a.replace("${title}",o);const r=t.querySelector(".play-pause > i"),l=t.querySelector(".remove-timer > i"),n=t.querySelector(".refresh-timer");let d=t.querySelector(".clear-time"),m=t.querySelector(".save-time"),u=t.querySelector(".time");storedTimeEntries=localTimeEntries("get");let T=storedTimeEntries.docs[e];storedTimers=localTimers("get"),storedTimers.docs[e]&&(TIMERS.docs[e]={...storedTimers.docs[e],interval:null},o=storedTimers.docs[e].title!==`timer-${e.substring(0,5)}`?storedTimers.docs[e].title:TIMERS.docs[e].title),t.querySelector("[name='title']").value!==o&&(t.querySelector("[name='title']").value=o),TIMERS.docs[e]&&TIMERS.docs[e].secondsElapsed>0&&(d.classList.remove("disabled"),m.classList.remove("disabled")),c.addEventListener("submit",(function(e){e.preventDefault(),c.querySelector("input").blur()})),c.querySelector("input").addEventListener("blur",(function(t){updateTitle(e,t.target.value)})),r.addEventListener("click",(function(){"true"===r.dataset.playing?(r.dataset.playing="false",r.classList.add("fa-play-circle"),r.classList.remove("fa-pause-circle"),clearInterval(TIMERS.docs[e].interval)):(r.dataset.playing="true",r.classList.remove("fa-play-circle"),r.classList.add("fa-pause-circle"),TIMERS.docs[e].start=TIMERS.docs[e].secondsElapsed>0?dayjs().subtract(TIMERS.docs[e].secondsElapsed,"seconds"):dayjs(),TIMERS.docs[e].interval=setInterval((function(){showTimerTime(u,e,!0)}),500),d.classList.remove("disabled"),m.classList.remove("disabled"))})),l.addEventListener("click",(function(){let t;document.querySelectorAll(".timer").forEach((s=>{s.dataset.idx===e&&(t=s)})),t&&t.remove(),delete TIMERS.docs[e],TIMERS.count=TIMERS.count>0?TIMERS.count-1:0,localTimers("save")})),d.addEventListener("click",(function(){d.classList.contains("disabled")||(r.dataset.playing=!1,r.classList.remove("fa-pause-circle"),r.classList.add("fa-play-circle"),clearInterval(TIMERS.docs[e].interval),TIMERS.docs[e]={...TIMERS.docs[e],interval:null,end:dayjs(),secondsElapsed:0},u.innerText="00:00:00",localTimers("save"),d.classList.add("disabled"),m.classList.add("disabled"))})),m.addEventListener("click",(function(){m.classList.contains("disabled")||(storedTimers=localTimers("get"),storedTimeEntries=localTimeEntries("get"),r.dataset.playing=!1,r.classList.remove("fa-pause-circle"),r.classList.add("fa-play-circle"),clearInterval(TIMERS.docs[e].interval),TIMERS.docs[e]={...TIMERS.docs[e],lastSaved:dayjs(),interval:null},localTimers("save"),storedTimers=localTimers("get"),T?(TIME_ENTRIES.docs[e]={...T,title:TIMERS.docs[e].title,updated:dayjs(),secondsElapsed:TIMERS.docs[e].secondsElapsed},T.title!==o&&(TIME_ENTRIES.docs[e].title=o)):TIME_ENTRIES.docs[e]={title:TIMERS.docs[e].title,created:dayjs(),updated:dayjs(),secondsElapsed:TIMERS.docs[e].secondsElapsed},TIME_ENTRIES.count=Object.keys(TIME_ENTRIES.docs).length,localTimeEntries("save"),storedTimeEntries=localTimeEntries("get"))})),n.addEventListener("click",(function(){let t=uuidv4();TIMERS.docs[t]={...TIMERS.docs[e],interval:null,title:`timer-${t.substring(0,5)}`},delete TIMERS.docs[e],document.querySelectorAll(".timer").forEach((s=>{s.dataset.idx===e&&(s.setAttribute("data-idx",t),s.querySelector(".title-input").value=`timer-${t.substring(0,5)}`,s.querySelector(".time-container > span:first-child").setAttribute("data-tooltip",t))})),localTimers("save"),showToast({position:"bl",type:"success",title:"Timer UUID refreshed!",message:`New UUID (<span class='font-mono'>${e=t}</span>) assigned to timer.`,fadeDelay:3e3})})),timersContainer.append(t),TIMERS.count+=1,updateData(e)}}const addTimerBtn=document.querySelector(".add-timer");function updateClockSize(){clockSize={width:clockContainer.clientWidth,height:clockContainer.clientWidth,circle:clockContainer.clientWidth-40,radius:clockContainer.clientWidth/4-40}}function addDots(){for(;DOTS_CONTAINER.firstChild;)DOTS_CONTAINER.removeChild(DOTS_CONTAINER.firstChild);for(var e=clockSize.radius/3,t=(clockSize.width,0),s=2*Math.PI/59,i=1;i<=59;i++){let l=document.createElement("i");l.classList.add("dot",`dot-${i}`,"far","fa-circle","text-xxs","md:text-xs","m-0.5","text-accent-500","absolute"),l.setAttribute("data-idx",i);var o=window.innerWidth<640?8:12,c=o,a=Math.round(2*e*Math.cos(t)-o/2),r=Math.round(2*e*Math.sin(t)-c/2);l.style.top=`${r}px`,l.style.left=`${a}px`,t+=s,DOTS_CONTAINER.appendChild(l)}}function setCircle(){var e=clockSize.circle,t=clockSize.width,s=clockSize.height,i=clockSize.radius/1.5,o=.05*e;CIRCLE_CONTAINER.style.width=`${t}px`,CIRCLE_CONTAINER.style.height=`${s}px`,document.querySelectorAll(".circle").forEach((e=>{e.setAttribute("cy",s/2),e.setAttribute("cx",t/2),e.setAttribute("r",i),e.style.strokeWidth=o})),FILL_CIRCLE.style.strokeDasharray=3*e,FILL_CIRCLE.style.strokeDashoffset=3*e,updateCircle()}function updateCircle(e=null){if(null===e){e=(new Date).getSeconds()}var t=3*clockSize.circle;FILL_CIRCLE.style.strokeDashoffset=t-t*(e/85)}function updateOptions(){let e=void 0!==localStorage.getItem("sktt_timer_options")?JSON.parse(localStorage.getItem("sktt_timer_options")):null;const t={show_seconds:document.querySelector("[name='show_seconds']").checked,sec_numbers:document.querySelector("[name='sec_numbers']").checked,seconds_display:document.querySelector("[name='seconds_display']").value,hr24:document.querySelector("[name='hr24']").checked,clock_right:document.querySelector("[name='clock_right']").checked};OPTIONS=void 0===OPTIONS.show_seconds&&null!==e?e:t,localStorage.setItem("sktt_timer_options",JSON.stringify(OPTIONS)),Object.keys(OPTIONS).forEach((e=>{"seconds_display"!==e?document.querySelector(`[name="${e}"]`).checked=OPTIONS[e]:document.querySelector("[name='seconds_display']").value=OPTIONS.seconds_display})),OPTIONS.show_seconds?(document.querySelector("[name='seconds_display']").style.display="block",document.querySelector("[for='sec_numbers']").style.display="block"):(document.querySelector("[name='seconds_display']").style.display="none",document.querySelector("[name='sec_numbers']").checked=!1,document.querySelector("[for='sec_numbers']").style.display="none"),updateLayout(),updateClockDisplay()}function updateClockDisplay(){if(document.querySelector("#seconds_display").classList.add("hidden"),DOTS_CONTAINER.classList.add("hidden"),LINE_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden"),OPTIONS.show_seconds){document.querySelector("#seconds_display").classList.remove("hidden");const e=OPTIONS.seconds_display;"dots"===e?(DOTS_CONTAINER.classList.remove("hidden"),LINE_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden")):"line"===e?(LINE_CONTAINER.classList.remove("hidden"),DOTS_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden")):"circle"===e?(LINE_CONTAINER.classList.add("hidden"),DOTS_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.remove("hidden"),setCircle()):(DOTS_CONTAINER.classList.add("hidden"),LINE_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden"))}}function showClockTime(){let e=new Date,t=e.getHours(),i=e.getMinutes(),o=e.getSeconds(),c=t>12?"PM":"AM";t>12&&!OPTIONS.hr24&&(t-=12),s=o<10?"0"+o:o;let a=`${t<10?"0"+t:t}:${i<10?"0"+i:i}`;if(OPTIONS.show_seconds&&OPTIONS.sec_numbers&&(a+=`:${s}`),OPTIONS.hr24||(a+=` ${c}`),OPTIONS.show_seconds&&"dots"===OPTIONS.seconds_display&&DOTS_CONTAINER.querySelectorAll(".dot").forEach((e=>{0===o?(e.classList.add("far"),e.classList.remove("fas")):parseInt(e.dataset.idx)<=o&&(e.classList.remove("far"),e.classList.add("fas"))})),OPTIONS.show_seconds&&"line"===OPTIONS.seconds_display){let e=o/59*100;LINE.style.width=`${e}%`}OPTIONS.show_seconds&&"circle"===OPTIONS.seconds_display&&updateCircle(o),CLOCK.innerText=a,clockSize.width!==clockContainer.clientWidth&&updateSecondsDisplay()}function updateSecondsDisplay(){updateClockSize(),"dots"===OPTIONS.seconds_display?addDots():"circle"===OPTIONS.seconds_display&&setCircle()}addTimerBtn.addEventListener("click",(function(){buildTimer(uuidv4())})),updateOptions(),addDots(),setCircle(),updateClockDisplay(),document.querySelectorAll("input.opt-input").forEach((e=>{e.addEventListener("click",(function(){updateOptions(),"clock_right"===e.name?updateLayout(e.value):(updateClockDisplay(),clearInterval(CLOCK_INTERVAL),CLOCK_INTERVAL=setInterval(showClockTime,1e3))}))})),document.querySelector("#seconds_display").addEventListener("change",(e=>{updateOptions()}));let optionsTitle=document.querySelector(".options-title");function updateLayout(){const e=document.querySelector("#main");OPTIONS.clock_right?(clockContainer.classList.remove("place-top","md:place-left"),clockContainer.classList.add("place-bottom","md:place-right"),tabbedContentContainer.classList.remove("place-bottom","md:place-right"),tabbedContentContainer.classList.add("place-top","md:place-left"),e.classList.remove("clock_left"),e.classList.add("clock_right")):(clockContainer.classList.remove("place-bottom","md:place-right"),clockContainer.classList.add("place-top","md:place-left"),tabbedContentContainer.classList.remove("place-top","md:place-left"),tabbedContentContainer.classList.add("place-bottom","md:place-right"),e.classList.remove("clock_right"),e.classList.add("clock_left"))}optionsTitle.addEventListener("click",(e=>{"true"==optionsTitle.dataset.open?(optionsTitle.dataset.open=!1,optionsTitle.querySelector(".fad").classList.remove("fa-angle-up"),optionsTitle.querySelector(".fad").classList.add("fa-angle-down"),document.querySelector(".options_container").classList.add("scale-y-0")):(optionsTitle.dataset.open=!0,optionsTitle.querySelector(".fad").classList.remove("fa-angle-down"),optionsTitle.querySelector(".fad").classList.add("fa-angle-up"),document.querySelector(".options_container").classList.remove("scale-y-0"))})),updateLayout();const tabsNav=document.querySelector("#tabs");let tabTarget="timers_container";function handleTabs(e){let t=document.querySelectorAll(".tab")[0];document.querySelectorAll(".tab").forEach((s=>{s.dataset.content!==e||(t=s)}));const s=t.dataset.content;t.classList.add("active"),getSiblings(t).forEach((e=>{e.classList.remove("active")})),document.querySelectorAll(".tab-content").forEach((e=>{e.getAttribute("id")===s||e.classList.contains("hidden")||e.classList.add("hidden"),e.getAttribute("id")===s&&e.classList.contains("hidden")&&e.classList.remove("hidden")})),localStorage.setItem("sktt_tab",s)}localStorage.getItem("sktt_tab")&&(tabTarget=localStorage.getItem("sktt_tab")),handleTabs(tabTarget),document.querySelectorAll(".tab").forEach((e=>{e.addEventListener("click",(function(){handleTabs(e.dataset.content)}))}));let timeEntries=document.querySelector("#time_entries tbody");function localTimeEntries(e){let t;return"get"===e&&(t=void 0!==localStorage.getItem("sktt_time_entries")?JSON.parse(localStorage.getItem("sktt_time_entries")):{message:"no time_entries found"}),"set"!==e&&"save"!==e||(Object.keys(TIME_ENTRIES.docs).forEach((e=>{TIME_ENTRIES.docs[e].title||delete TIME_ENTRIES.docs[e]})),localStorage.setItem("sktt_time_entries",JSON.stringify(TIME_ENTRIES)),t={message:"saved time entries"}),"clear"===e&&(localStorage.removeItem("sktt_time_entries"),t={message:"timers removed"}),t}function updateTimeEntries(){storedTimeEntries=localTimeEntries("get"),storedTimeEntries.count>0&&(TIME_ENTRIES=storedTimeEntries,timeEntries.innerHTML="",Object.keys(storedTimeEntries.docs).forEach((e=>{const t=storedTimeEntries.docs[e],s=getTimeObject(t.secondsElapsed);let i=document.createElement("tr");i.setAttribute("id",`te-${e}`);const o={title:t.title,time:`${padTime(s.h)}:${padTime(s.m)}:${padTime(s.s)}`,created:dayjs(t.created).format("YYYY-MM-DD HH:mm:ss"),updated:dayjs(t.updated).format("YYYY-MM-DD HH:mm:ss")};Object.keys(o).forEach((e=>{let t=document.createElement("td");t.innerText=o[e],i.append(t)}));let c=document.createElement("td"),a=document.createElement("i");a.classList.add("load-time-entry","fas","fa-recycle"),a.addEventListener("click",(function(){let t=document.querySelector(`#te-${e}`).getAttribute("id").substring(3);TIMERS.docs[t]?showToast({position:"mm",title:"Timer Already Exists!",message:`A timer with the UUID <span class='font-mono'>${t}</span> already exists! If that timer should be for a different entry, please refresh the UUID for the timer and save it as a new time entry.`,type:"error"}):(TIMERS.docs[t]={...TIME_ENTRIES.docs[t]},TIMERS.count=TIMERS.count+1,localTimers("save"),buildTimer(t),handleTabs("timers"))})),c.append(a),i.append(c);let r=document.createElement("td"),l=document.createElement("i");l.classList.add("remove-time-entry","fad","fa-minus-square","fa-swap-opacity"),l.addEventListener("click",(function(){document.querySelector(`#te-${e}`).remove(),delete TIME_ENTRIES.docs[e],TIME_ENTRIES.count=TIME_ENTRIES.count>0?TIME_ENTRIES.count-1:0,localTimeEntries("save")})),r.append(l),i.append(r),timeEntries.append(i)})))}updateTimeEntries(),document.querySelectorAll(".tab").forEach((e=>{"time_entries"===e.dataset.content&&e.addEventListener("click",updateTimeEntries)})),document.querySelectorAll(".timer").forEach((e=>{e.querySelector(".form").addEventListener("submit",updateTimeEntries),e.querySelector(".title-input").addEventListener("blur",updateTimeEntries)}));