const clockContainer=document.querySelector("#clock_container"),tabbedContentContainer=document.querySelector("#tabbedContent"),timersContainer=document.querySelector("#timers_container"),CLOCK=document.querySelector("#clock"),DOTS_CONTAINER=document.querySelector("#dotsContainer"),LINE_CONTAINER=document.querySelector("#lineContainer"),LINE=document.querySelector("#line"),CIRCLE_CONTAINER=document.querySelector("#circleContainer"),CIRCLE=document.querySelector("#circleContainer .circle"),FILL_CIRCLE=document.querySelector("#circleContainer .fill-circle");let clockSize={width:clockContainer.clientWidth,height:clockContainer.clientHeight,circle:clockContainer.clientWidth-40,radius:(clockContainer.clientWidth-40)/2},OPTIONS={},CLOCK_INTERVAL=setInterval(showClockTime,1e3),TIMERS={},storedTimers=localStorage.getItem("sktt_timers")?JSON.parse(localStorage.getItem("sktt_timers")):null,TIME_ENTRIES={},storedTimeEntries=localStorage.getItem("sktt_time_entries")?JSON.parse(localStorage.getItem("sktt_time_entries")):null;function getChildren(e,t){for(var s=[];e;e=e.nextSibling)1==e.nodeType&&e!=t&&s.push(e);return s}function getSiblings(e){return getChildren(e.parentNode.firstChild,e)}function getTimeObject(e){return{h:Math.floor(e/3600),m:Math.floor(e/60%60),s:Math.floor(e%60)}}if(null===storedTimers){buildTimer(uuidv4())}else Object.keys(storedTimers).forEach((e=>{buildTimer(e)}));function localTimers(e){let t;return"get"===e&&(t=void 0!==localStorage.getItem("sktt_timers")?JSON.parse(localStorage.getItem("sktt_timers")):{message:"no timers found"}),"set"!==e&&"save"!==e||(localStorage.setItem("sktt_timers",JSON.stringify(TIMERS)),t={message:"saved timers"}),"clear"===e&&(localStorage.removeItem("sktt_timers"),t={message:"timers removed"}),t}function showTimerTime(e,t,s=!1){if(s){let s=dayjs(TIMERS[t].start),i=dayjs().diff(s,"second",!0),a=getTimeObject(i);TIMERS[t]={...TIMERS[t],secondsElapsed:Math.floor(i)},localTimers("save"),e.innerText=`${padTime(a.h)}:${padTime(a.m)}:${padTime(a.s)}`}else if(TIMERS[t].secondsElapsed>0){let s=getTimeObject(TIMERS[t].secondsElapsed);e.innerText=`${padTime(s.h)}:${padTime(s.m)}:${padTime(s.s)}`}else e.innerText="00:00:00"}function padTime(e){return e<10&&(e=`0${e}`),e}function updateData(e){let t,s;storedTimers=localTimers("get"),null!==storedTimers&&!storedTimers.message&&storedTimers[e]?(TIMERS[e]={...storedTimers[e],interval:null},null!==storedTimeEntries&&storedTimeEntries[e]&&(TIME_ENTRIES[e]={...storedTimeEntries[e]})):(TIMERS[e]={title:`timer-${e.substring(0,5)}`,interval:null,start:dayjs(),secondsElapsed:0},TIME_ENTRIES[e]={title:`timer-${e.substring(0,5)}`,created:dayjs(),updated:dayjs(),secondsElapsed:0}),document.querySelectorAll(".timer").forEach((i=>{i.dataset.idx===e&&(t=i,s=i.querySelector(".time"))})),void 0!==t&&showTimerTime(s,e)}function buildTimer(e){if(void 0!==e){let t=document.querySelector("#timerTemplate").content.cloneNode(!0);t.querySelector(".timer").dataset.idx=e;let s=t.querySelector(".form").innerHTML;t.querySelector(".form").innerHTML=s.replace("${title}",`timer-${e.substring(0,5)}`);const i=t.querySelector(".play-pause > i"),a=t.querySelector(".remove-timer > i");let r=t.querySelector(".clear-time"),l=t.querySelector(".save-time"),c=t.querySelector(".time");i.addEventListener("click",(function(){"true"===i.dataset.playing?(i.dataset.playing="false",i.classList.add("fa-play-circle"),i.classList.remove("fa-pause-circle"),clearInterval(TIMERS[e].interval)):(i.dataset.playing="true",i.classList.remove("fa-play-circle"),i.classList.add("fa-pause-circle"),TIMERS[e].start=TIMERS[e].secondsElapsed>0?dayjs().subtract(TIMERS[e].secondsElapsed,"seconds"):dayjs(),TIMERS[e].interval=setInterval((function(){showTimerTime(c,e,!0)}),500),r.classList.remove("disabled"),l.classList.remove("disabled"))})),a.addEventListener("click",(function(){let t;document.querySelectorAll(".timer").forEach((s=>{s.dataset.idx===e&&(t=s)})),console.log(t),t&&t.remove(),delete TIMERS[e],localTimers("save")})),timersContainer.append(t),updateData(e)}}function updateClockSize(){clockSize={width:clockContainer.clientWidth,height:clockContainer.clientWidth,circle:clockContainer.clientWidth-40,radius:clockContainer.clientWidth/4-40}}function addDots(){for(;DOTS_CONTAINER.firstChild;)DOTS_CONTAINER.removeChild(DOTS_CONTAINER.firstChild);for(var e=clockSize.radius/3,t=(clockSize.width,0),s=2*Math.PI/59,i=1;i<=59;i++){let o=document.createElement("i");o.classList.add("dot",`dot-${i}`,"far","fa-circle","text-xxs","md:text-xs","m-0.5","text-accent-500","absolute"),o.setAttribute("data-idx",i);var a=window.innerWidth<640?8:12,r=a,l=Math.round(2*e*Math.cos(t)-a/2),c=Math.round(2*e*Math.sin(t)-r/2);o.style.top=`${c}px`,o.style.left=`${l}px`,t+=s,DOTS_CONTAINER.appendChild(o)}}function setCircle(){var e=clockSize.circle,t=clockSize.width,s=clockSize.height,i=clockSize.radius/1.5,a=.05*e;CIRCLE_CONTAINER.style.width=`${t}px`,CIRCLE_CONTAINER.style.height=`${s}px`,document.querySelectorAll(".circle").forEach((e=>{e.setAttribute("cy",s/2),e.setAttribute("cx",t/2),e.setAttribute("r",i),e.style.strokeWidth=a})),FILL_CIRCLE.style.strokeDasharray=3*e,FILL_CIRCLE.style.strokeDashoffset=3*e,updateCircle()}function updateCircle(e=null){if(null===e){e=(new Date).getSeconds()}var t=3*clockSize.circle;FILL_CIRCLE.style.strokeDashoffset=t-t*(e/85)}function updateOptions(){let e=void 0!==localStorage.getItem("sktt_timer_options")?JSON.parse(localStorage.getItem("sktt_timer_options")):null;const t={show_seconds:document.querySelector("[name='show_seconds']").checked,sec_numbers:document.querySelector("[name='sec_numbers']").checked,seconds_display:document.querySelector("[name='seconds_display']").value,hr24:document.querySelector("[name='hr24']").checked,clock_right:document.querySelector("[name='clock_right']").checked};OPTIONS=void 0===OPTIONS.show_seconds&&null!==e?e:t,localStorage.setItem("sktt_timer_options",JSON.stringify(OPTIONS)),Object.keys(OPTIONS).forEach((e=>{"seconds_display"!==e?OPTIONS[e]?document.querySelector(`[name="${e}"]`).setAttribute("checked",!0):document.querySelector(`[name="${e}"]`).removeAttribute("checked"):document.querySelector("[name='seconds_display']").value=OPTIONS.seconds_display})),updateLayout(),updateClockDisplay()}function updateClockDisplay(){if(document.querySelector("#seconds_display").classList.add("hidden"),DOTS_CONTAINER.classList.add("hidden"),LINE_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden"),OPTIONS.show_seconds){document.querySelector("#seconds_display").classList.remove("hidden");const e=OPTIONS.seconds_display;"dots"===e?(DOTS_CONTAINER.classList.remove("hidden"),LINE_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden")):"line"===e?(LINE_CONTAINER.classList.remove("hidden"),DOTS_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden")):"circle"===e?(LINE_CONTAINER.classList.add("hidden"),DOTS_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.remove("hidden"),setCircle()):(DOTS_CONTAINER.classList.add("hidden"),LINE_CONTAINER.classList.add("hidden"),CIRCLE_CONTAINER.classList.add("hidden"))}}function showClockTime(){let e=new Date,t=e.getHours(),i=e.getMinutes(),a=e.getSeconds(),r=t>12?"PM":"AM";t>12&&!OPTIONS.hr24&&(t-=12),s=a<10?"0"+a:a;let l=`${t<10?"0"+t:t}:${i<10?"0"+i:i}`;if(OPTIONS.show_seconds&&OPTIONS.sec_numbers&&(l+=`:${s}`),OPTIONS.hr24||(l+=` ${r}`),OPTIONS.show_seconds&&"dots"===OPTIONS.seconds_display&&DOTS_CONTAINER.querySelectorAll(".dot").forEach((e=>{0===a?(e.classList.add("far"),e.classList.remove("fas")):parseInt(e.dataset.idx)<=a&&(e.classList.remove("far"),e.classList.add("fas"))})),OPTIONS.show_seconds&&"line"===OPTIONS.seconds_display){let e=a/59*100;LINE.style.width=`${e}%`}OPTIONS.show_seconds&&"circle"===OPTIONS.seconds_display&&updateCircle(a),CLOCK.innerText=l,clockSize.width!==clockContainer.clientWidth&&updateSecondsDisplay()}function updateSecondsDisplay(){updateClockSize(),"dots"===OPTIONS.seconds_display?addDots():"circle"===OPTIONS.seconds_display&&setCircle()}function updateTitle(e,t){TIMERS[e].title=t,localTimers("save"),TIME_ENTRIES[e]&&(TIME_ENTRIES[e].title=t),storedTimeEntries=localTimeEntries("get"),storedTimeEntries[e]&&localTimeEntries("save")}updateOptions(),addDots(),setCircle(),updateClockDisplay(),document.querySelectorAll("input.opt-input").forEach((e=>{e.addEventListener("click",(function(){updateOptions(),"clock_right"===e.name?updateLayout(e.value):(updateClockDisplay(),clearInterval(CLOCK_INTERVAL),CLOCK_INTERVAL=setInterval(showClockTime,1e3))}))})),document.querySelector("#seconds_display").addEventListener("change",(e=>{updateOptions()})),document.querySelectorAll(".timer").forEach((e=>{const t=e.querySelector("form"),s=e.dataset.idx,i=e.querySelector(".play-pause > i");storedTimers=localTimers("get");let a=e.querySelector(".clear-time"),r=e.querySelector(".save-time"),l=e.querySelector("[name='title']").value,c=e.querySelector(".time");null!==storedTimers&&!storedTimers.message&&storedTimers[s]&&(TIMERS[s]={...storedTimers[s],interval:null},l=TIMERS[s].title!==storedTimers[s].title?storedTimers[s].title:TIMERS[s].title),e.querySelector("[name='title']").value!==l&&(e.querySelector("[name='title']").value=l),TIMERS[s]&&TIMERS[s].secondsElapsed>0&&(a.classList.remove("disabled"),r.classList.remove("disabled")),a.addEventListener("click",(function(){a.classList.contains("disabled")||(i.dataset.playing=!1,i.classList.remove("fa-pause-circle"),i.classList.add("fa-play-circle"),clearInterval(TIMERS[s].interval),TIMERS[s]={...TIMERS[s],interval:null,end:dayjs(),secondsElapsed:0},c.innerText="00:00:00",localTimers("save"),a.classList.add("disabled"),r.classList.add("disabled"))})),r.addEventListener("click",(function(){r.classList.contains("disabled")||(l=e.querySelector("[name='title']").value,storedTimers=localTimers("get"),storedTimeEntries=localTimeEntries("get"),i.dataset.playing=!1,i.classList.remove("fa-pause-circle"),i.classList.add("fa-play-circle"),clearInterval(TIMERS[s].interval),TIMERS[s]={...TIMERS[s],lastSaved:dayjs(),interval:null},localTimers("save"),storedTimeEntries[s]?(TIME_ENTRIES[s]={...storedTimeEntries[s],updated:dayjs(),secondsElapsed:TIMERS[s].secondsElapsed},storedTimeEntries[s].title!==l&&(TIME_ENTRIES[s].title=l)):TIME_ENTRIES[s]={title:l,created:dayjs(),updated:dayjs(),secondsElapsed:TIMERS[s].secondsElapsed},localTimeEntries("save"))})),t.addEventListener("submit",(function(e){e.preventDefault(),t.querySelector("input").blur(),updateTitle(s,e.target[0].value)})),t.querySelector("input").addEventListener("blur",(function(e){updateTitle(s,e.target.value)}))}));const addTimerBtn=document.querySelector(".add-timer");function updateLayout(){OPTIONS.clock_right?(clockContainer.classList.remove("place-top","md:place-left"),clockContainer.classList.add("place-bottom","md:place-right"),tabbedContentContainer.classList.remove("place-bottom","md:place-right"),tabbedContentContainer.classList.add("place-top","md:place-left")):(clockContainer.classList.remove("place-bottom","md:place-right"),clockContainer.classList.add("place-top","md:place-left"),tabbedContentContainer.classList.remove("place-top","md:place-left"),tabbedContentContainer.classList.add("place-bottom","md:place-right"))}addTimerBtn.addEventListener("click",(function(){buildTimer(uuidv4())})),updateLayout();const tabsNav=document.querySelector("#tabs"),inactiveColor=tabsNav.dataset.inactiveColor;let tabTarget="timers_container";function handleTabs(e){let t=document.querySelectorAll(".tab")[0];document.querySelectorAll(".tab").forEach((s=>{s.dataset.content!==e||(t=s)}));const s=t.dataset.content,i=t.dataset.color;t.classList.add("active",i),t.classList.remove(inactiveColor),getSiblings(t).forEach((e=>{e.classList.remove("active",i),e.classList.add(inactiveColor)})),document.querySelectorAll(".tab-content").forEach((e=>{e.getAttribute("id")===s||e.classList.contains("hidden")||e.classList.add("hidden"),e.getAttribute("id")===s&&e.classList.contains("hidden")&&e.classList.remove("hidden")})),localStorage.setItem("sktt_tab",s)}localStorage.getItem("sktt_tab")&&(tabTarget=localStorage.getItem("sktt_tab")),handleTabs(tabTarget),document.querySelectorAll(".tab").forEach((e=>{e.addEventListener("click",(function(){handleTabs(e.dataset.content)}))}));let timeEntries=document.querySelector("#time_entries tbody");function localTimeEntries(e){let t;return"get"===e&&(t=void 0!==localStorage.getItem("sktt_time_entries")?JSON.parse(localStorage.getItem("sktt_time_entries")):{message:"no time_entries found"}),"set"!==e&&"save"!==e||(Object.keys(TIME_ENTRIES).forEach((e=>{TIME_ENTRIES[e].title||delete TIME_ENTRIES[e]})),localStorage.setItem("sktt_time_entries",JSON.stringify(TIME_ENTRIES)),t={message:"saved time entries"}),"clear"===e&&(localStorage.removeItem("sktt_time_entries"),t={message:"timers removed"}),t}function updateTimeEntries(){storedTimeEntries=localTimeEntries("get"),null!==storedTimeEntries&&Object.keys(storedTimeEntries).length>0&&(timeEntries.innerHTML="",Object.keys(storedTimeEntries).forEach((e=>{const t=storedTimeEntries[e],s=getTimeObject(t.secondsElapsed);let i=document.createElement("tr");i.setAttribute("id",`te-${e}`);const a={title:t.title,time:`${padTime(s.h)}:${padTime(s.m)}:${padTime(s.s)}`,created:dayjs(t.created).format("YYYY-MM-DD HH:mm:ss"),updated:dayjs(t.updated).format("YYYY-MM-DD HH:mm:ss")};Object.keys(a).forEach((e=>{let t=document.createElement("td");t.innerText=a[e],i.append(t)}));let r=document.createElement("td"),l=document.createElement("i");l.classList.add("remove-time-entry","fad","fa-minus-square","text-4xl","text-accent-500","hover:text-accent-700"),l.addEventListener("click",(function(){document.querySelector(`#te-${e}`).remove(),delete TIME_ENTRIES[e],localTimeEntries("save")})),r.append(l),i.append(r),timeEntries.append(i)})))}updateTimeEntries(),document.querySelectorAll(".tab").forEach((e=>{"time_entries"===e.dataset.content&&e.addEventListener("click",updateTimeEntries)})),document.querySelectorAll(".timer").forEach((e=>{e.querySelector(".form").addEventListener("submit",updateTimeEntries),e.querySelector(".title-input").addEventListener("blur",updateTimeEntries)}));